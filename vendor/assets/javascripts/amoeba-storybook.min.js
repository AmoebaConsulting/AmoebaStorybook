/*! amoeba-storybook - v0.1.1 - 2013-02-07
* Copyright (c) 2013 ; Licensed  */
(function(){var e;(e=window.AmoebaSB)==null&&(window.AmoebaSB={}),jQuery(function(e){return AmoebaSB.eventHelper=new AmoebaSB.EventHelper})}).call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};AmoebaSB.CogDemo=function(){function n(e,n,r){var i;this.size=n,this.numSegments=r,this.stop=t(this.stop,this),this.start=t(this.start,this),this.graphicsPaper=new AmoebaSB.GraphicsPaper(e,{fill:"transparent",stroke:"transparent"}),this.animations=[],i=new AmoebaSB.Cog(this.size,this.numSegments,this.graphicsPaper),this.pathMap={cog:i.path(!0),circleCog:i.path(!1),circle4Points:AmoebaSB.Graphics.circleWithFourPoints(0,0,this.size/2),rect4Points:AmoebaSB.Graphics.rectWithFourPoints(0,0,200,300)}}return n.prototype.start=function(){var t,n,r,i,s,o,u=this;this.stop(),t=["#384F0E","#8BA400","#A6CC2F"],_.each([0,1,2],function(n){return u.animations.push(new e(t[n],n,u.size,u.graphicsPaper,u.pathMap))}),s=this.animations,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(n.animate());return o},n.prototype.stop=function(){var e,t,n,r;if(this.animations!=null){r=this.animations;for(t=0,n=r.length;t<n;t++)e=r[t],e.remove()}return this.animations.length=0},n}(),e=function(){function e(e,n,r,i,s){this.fillColor=e,this.index=n,this.cogSize=r,this.pathMap=s,this.changeToPathFive=t(this.changeToPathFive,this),this.changeToPathFour=t(this.changeToPathFour,this),this.changeToPathThree=t(this.changeToPathThree,this),this.changeToPathTwo=t(this.changeToPathTwo,this),this.rotate=t(this.rotate,this),this.pathSwitch=!0,this.removed=!1,this.mainPath=i.paper.path(this.pathOne()).attr({fill:this.fillColor,opacity:0,transform:"t"+i.width()+",0"})}return e.prototype.remove=function(){var e=this;return this.removed=!0,this.mainPath.animate({opacity:0},400,"<>",function(){return e.mainPath.remove()})},e.prototype.animate=function(){var e=this;return setTimeout(function(){return e._animate()},100*this.index)},e.prototype._animate=function(){var e=this;return this._stop(),this.mainPath.animate({opacity:1,transform:"t0,0"},600,"<>",function(){return e.rotate()})},e.prototype._stop=function(){if(!this.removed)return this.mainPath.stop()},e.prototype.rotate=function(){var e,t,n=this;return t="r0",e="r360",this.index%2===0&&(t="r360",e="r0"),this.mainPath.animate({transform:t},0,"",function(){return n.mainPath.animate({transform:e},6e3,"<>",function(){return n.changeToPathTwo()})})},e.prototype.changeToPathTwo=function(){var e=this;return this.mainPath.animate({path:this.pathTwo()},800,"<>",function(){return e.changeToPathThree()})},e.prototype.changeToPathThree=function(){var e=this;return this.mainPath.animate({path:this.pathThree()},0,"",function(){return e.changeToPathFour()})},e.prototype.changeToPathFour=function(){var e=this;return this.mainPath.animate({path:this.pathFour()},800,"<>",function(){return e.changeToPathFive()})},e.prototype.changeToPathFive=function(){var e=this;return setTimeout(function(){var t,n;t=e.mainPath.getBBox();if(t!=null)return n=700-t.y2,e.mainPath.animate({transform:"t0,"+n},800,"bounce",function(){return console.log("done")})},500)},e.prototype.pathOne=function(){var e,t;return e=this.pathMap.cog,e=AmoebaSB.Graphics.normalizePath(e),t=0,this.index%2!==0&&(t=200),e=AmoebaSB.Graphics.translatePath(e,this.index*(this.cogSize-80),t),e},e.prototype.pathTwo=function(){var e;return e=this.pathMap.circleCog,e=AmoebaSB.Graphics.normalizePath(e),e=AmoebaSB.Graphics.scalePath(e,.5,.5),e=AmoebaSB.Graphics.translatePath(e,100+this.index*220,120),e},e.prototype.pathThree=function(){var e;return e=this.pathMap.circle4Points,e=AmoebaSB.Graphics.normalizePath(e),e=AmoebaSB.Graphics.scalePath(e,.5,.5),e=AmoebaSB.Graphics.translatePath(e,100+this.index*220,120),e},e.prototype.pathFour=function(){var e;return e=this.pathMap.rect4Points,e=AmoebaSB.Graphics.normalizePath(e),e=AmoebaSB.Graphics.scalePath(e,.5,.5+.3*(3-this.index)),e=AmoebaSB.Graphics.translatePath(e,500+this.index*120,220),e},e}()}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};AmoebaSB.EventHelper=function(){function t(){this._handleKeyEvent=e(this._handleKeyEvent,this),this._setupKeyHandler=e(this._setupKeyHandler,this),this.triggerEvent=e(this.triggerEvent,this),this._setupKeyHandler(),this.nextKeyEventName="next:keyEvent",this.prevKeyEventName="prev:keyEvent",this.resizeEventName="resize:windowEvent"}return t.prototype.triggerEvent=function(e,t,n){var r;return r=document.createEvent("CustomEvent"),r.initCustomEvent(t,!0,!0,n),e.dispatchEvent(r)},t.prototype._setupKeyHandler=function(){var e=this;return document.addEventListener("keydown",function(t){return e._handleKeyEvent(t)}),document.addEventListener("keyup",function(t){return e._handleKeyEvent(t)}),document.addEventListener("touchstart",function(t){var n,r;if(t.touches.length===1){r=t.touches[0].clientX,n=window.innerWidth*.3;if(r<n)return e.triggerEvent(document,e.prevKeyEventName),t.preventDefault();if(r>window.innerWidth-n)return e.triggerEvent(document,e.nextKeyEventName),t.preventDefault()}}),window.addEventListener("resize",function(t){if(!e.sentReizeEvent)return e.sentResizeEvent=!0,setTimeout(function(){return e.triggerEvent(document,e.resizeEventName),e.sentResizeEvent=!1},250)})},t.prototype._handleKeyEvent=function(e){var t,n,r,i,s,o,u;o=9,s=32,n=37,u=38,r=39,t=40,i=!1,e.type==="keyup"&&(i=!0);switch(e.keyCode){case o:case t:case r:case s:e.preventDefault();if(i)return this.triggerEvent(document,this.nextKeyEventName);break;case n:case u:e.preventDefault();if(i)return this.triggerEvent(document,this.prevKeyEventName)}},t}()}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};AmoebaSB.GraphicsPaper=function(){function t(t,n){this.divHolder=t,this._fadePoint=e(this._fadePoint,this),this.clearPoints=e(this.clearPoints,this),this.clearAll=e(this.clearAll,this),this.pulsatePoints=e(this.pulsatePoints,this),n==null&&(n={fill:"90-#aaf-#004",stroke:"#f99"}),this.paper=Raphael(this.divHolder),this.paper.rect(0,0,this.width(),this.height()).attr(n),this.points=[]}return t.prototype.width=function(){return this.paper.canvas.clientWidth?this.paper.canvas.clientWidth:this.paper.width},t.prototype.height=function(){return this.paper.canvas.clientHeight?this.paper.canvas.clientHeight:this.paper.height},t.prototype.addPoints=function(e,t,n){var r=this;return n==null&&(n="#f00"),_.each(e,function(e){var i;return i=r.paper.circle(e.x,e.y,t),i.attr({fill:n,stroke:"none"}),r.points.push(i)})},t.prototype.pulsatePoints=function(){var e=this;return _.each(this.points,function(t){return e._fadePoint(!0,t)})},t.prototype.clearAll=function(){return this.paper.clear()},t.prototype.clearPoints=function(){var e=this;return _.each(this.points,function(e){return e.remove()})},t.prototype._fadePoint=function(e,t){var n,r,i=this;return r=Raphael.animation({transform:"s2",opacity:1},600,"<",function(){return i._fadePoint(!e,t)}),n=Raphael.animation({transform:"s1",opacity:.1},600,">",function(){return i._fadePoint(!e,t)}),t.stop(),e?t.animate(r):t.animate(n)},t}(),AmoebaSB.Point=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.toString=function(){return"("+this.x+", "+this.y+")"},e.prototype.distance=function(e){var t,n;return t=e.x-this.x,t*=t,n=e.y-this.y,n*=n,Math.sqrt(t+n)},e}(),AmoebaSB.Pair=function(){function e(e,t){this.left=e,this.right=t}return e.prototype.toString=function(){return"("+this.left+", "+this.right+")"},e}(),AmoebaSB.Rect=function(){function e(e,t,n,r){this.x=e,this.y=t,this.w=n,this.h=r}return e.prototype.toString=function(){return"(x:"+this.x+", y:"+this.y+", w:"+this.w+", h:"+this.h+")"},e}(),AmoebaSB.Graphics=function(){function e(){}return e.toDegrees=function(e){return e*(180/Math.PI)},e.toRadians=function(e){return e*(Math.PI/180)},e.pointForAngle=function(e,t,n){var r,i;return r=Math.cos(AmoebaSB.Graphics.toRadians(e)),i=Math.sin(AmoebaSB.Graphics.toRadians(e)),new AmoebaSB.Point(n.x+r*t,n.y+i*t)},e.normalizePath=function(e){var t,n,r;return t=Raphael.pathBBox(e),n=new Raphael.matrix,n.translate(-t.x,-t.y),r=n.toTransformString(),e=Raphael.transformPath(e,r),e},e.scalePath=function(e,t,n){var r,i;return r=new Raphael.matrix,r.scale(t,n),i=r.toTransformString(),e=Raphael.transformPath(e,i),e},e.translatePath=function(e,t,n){var r,i;return r=new Raphael.matrix,r.translate(t,n),i=r.toTransformString(),e=Raphael.transformPath(e,i),e},e.rotatePath=function(e,t){var n,r,i;return n=Raphael.pathBBox(e),r=new Raphael.matrix,r.rotate(t,n.x+n.width/2,n.y+n.height/2),i=r.toTransformString(),e=Raphael.transformPath(e,i),e},e.circleWithFourPoints=function(e,t,n){var r,i,s=this;return r=new AmoebaSB.Point(e,t),i=void 0,_.each([0,90,180,270,360],function(o){var u;return u=s.pointForAngle(o,n,r),i!=null?i+="A"+n+","+n+",0,0,1,"+u.x+","+u.y:i="M"+(e+n)+", "+t}),i!=null&&(i+="z",i=this.rotatePath(i,-135)),i},e.rectWithFourPoints=function(e,t,n,r){var i;return i="M"+e+", "+t,i+="l"+n+", 0",i+="l0, "+r,i+="l"+ -n+", 0",i+="l0, "+ -r,i},e.trianglePath=function(e,t,n,r,i,s){var o;return o="M"+e+","+t,o+="L"+n+","+r,o+="L"+i+","+s,o},e}()}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};AmoebaSB.Cog=function(){function n(e,n,r){this.size=e,this.numSegments=n,this.graphicsPaper=r,this._createCogSegments=t(this._createCogSegments,this),this._pairsAroundCircle=t(this._pairsAroundCircle,this),this._pointsAroundCircle=t(this._pointsAroundCircle,this),this.showPoints=t(this.showPoints,this)}return n.prototype.path=function(e){var t,n,r=this;return n=this._createCogSegments(this.size,e,this.numSegments),t=void 0,_.each(n,function(e){return t==null&&(t="M"+e.bottomLeft.x+","+e.bottomLeft.y),t+=e.path()}),t+="z",t},n.prototype.showPoints=function(){var e,t=this;return e=this._createCogSegments(this.size,!0,this.numSegments),_.each(e,function(e){return e.debugPoints(t.graphicsPaper)})},n.prototype._pointsAroundCircle=function(e,t,n,r){var i,s,o,u,a,f,l=this;return r==null&&(r=0),i=new AmoebaSB.Point(e/2,e/2),o=(e-t*2)/2,s=360/n,u=[],_.each(function(){f=[];for(var e=0;0<=n?e<=n:e>=n;0<=n?e++:e--)f.push(e);return f}.apply(this),function(e){var t,n;return t=e*s,n=s*.15,r===-1?t-=n:r===1&&(t+=n),t>=360?t-=360:t<0&&(t=360+t),u.push(AmoebaSB.Graphics.pointForAngle(t,o,i))}),u},n.prototype._pairsAroundCircle=function(e,t,n,r){var i,s,o,u,a,f,l,c,h=this;return r==null&&(r=!1),u=[],r?(i=this._pointsAroundCircle(e,t,n,-1),a=this._pointsAroundCircle(e,t,n,-1),_.each(function(){c=[];for(var e=0,t=i.length-1;0<=t?e<t:e>t;0<=t?e++:e--)c.push(e);return c}.apply(this),function(e){return u.push(new AmoebaSB.Pair(i[e],a[e+1]))})):(s=this._pointsAroundCircle(e,t,n),o=void 0,_.each(s,function(e){return o!=null&&u.push(new AmoebaSB.Pair(o,e)),o=e})),u},n.prototype._createCogSegments=function(t,n,r){var i,s,o,u,a,f,l,c=this;return u=[],a=0,o=this._pairsAroundCircle(t,0,r,!1),n&&(a=o[0].left.distance(o[0].right)*.55),i=this._pairsAroundCircle(t,a,r,!1),o.length!==i.length||o.length!==r?console.log("inner and outer points not right?"):(s=!1,_.each(function(){l=[];for(var e=0;0<=r?e<r:e>r;0<=r?e++:e--)l.push(e);return l}.apply(this),function(n){var r,f,l;return l=o[n],r=i[n],f=new e(s,t,a,l.left,l.right,r.left,r.right),u.push(f),s=!s})),u},n}(),e=function(){function e(e,t,n,r,i,s,o){this.isTooth=e,this.size=t,this.toothHeight=n,this.topLeft=r,this.topRight=i,this.bottomLeft=s,this.bottomRight=o,this.outerRadius=this.size/2,this.innerRadius=(this.size-this.toothHeight*2)/2}return e.prototype.toString=function(){return"("+this.topLeft+", "+this.topRight+", "+this.bottomLeft+", "+this.bottomRight+")"},e.prototype.debugPoints=function(e){return this.isTooth?(e.addPoints([this.topLeft],2,"black"),e.addPoints([this.topRight],2,"orange"),e.addPoints([this.bottomLeft],2,"black"),e.addPoints([this.bottomRight],2,"orange")):(e.addPoints([this.topLeft],2,"red"),e.addPoints([this.topRight],2,"yellow"),e.addPoints([this.bottomLeft],2,"red"),e.addPoints([this.bottomRight],2,"yellow"))},e.prototype.path=function(){var e,t;return t="",this.isTooth?(t+="L"+this.topLeft.x+","+this.topLeft.y,t+="A"+this.outerRadius+","+this.outerRadius+",0,0,1,"+this.topRight.x+","+this.topRight.y,t+="L"+this.bottomRight.x+","+this.bottomRight.y):(e=1,this.toothHeight>0&&(e=0),t+="A"+this.outerRadius+","+this.outerRadius+",0,0,"+e+","+this.bottomRight.x+","+this.bottomRight.y),t},e}()}.call(this),function(){}.call(this);